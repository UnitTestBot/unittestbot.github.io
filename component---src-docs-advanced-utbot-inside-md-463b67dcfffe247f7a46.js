"use strict";(self.webpackChunkunittestbot_web=self.webpackChunkunittestbot_web||[]).push([[5628],{18095:function(e,t,r){r.r(t),r.d(t,{_frontmatter:function(){return l},default:function(){return m}});var a=r(87462),o=r(63366),n=(r(15007),r(64983)),s=r(23017),i=(r(8156),["components"]),l={};void 0!==l&&l&&l===Object(l)&&Object.isExtensible(l)&&!Object.prototype.hasOwnProperty.call(l,"__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"src/docs/advanced/utbot-inside.md"}});var p={_frontmatter:l},c=s.Z;function m(e){var t=e.components,r=(0,o.Z)(e,i);return(0,n.kt)(c,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"how-utbot-works"},"How UTBot Works"),(0,n.kt)("p",null,"UTBot uses KLEE symbolic execution engine to obtain information about program branches. C/C++ projects usually consist\nof source files and headers, which are compiled and linked into libraries and executable files (while libraries can also\nbe linked to one another or other executables, forming a directed acyclic graph of project linkage). Executables and\nlibraries can be considered as the artifacts of project building. KLEE operates with ",(0,n.kt)("a",{parentName:"p",href:"???"},"LLVM IR")," so, to symbolically\nexecute code from a given product, UTBot needs the information about how the project is compiled and linked in order to\nbe able to recompile it into LLVM IR. UTBot is able to get this information from project build system via Bear\ntool ",(0,n.kt)("a",{parentName:"p",href:"compile-databasse"},"more info"),". UTBot supports CMake and Makefile build systems."),(0,n.kt)("p",null,"Then, UTBot analyses given sources using ",(0,n.kt)("a",{parentName:"p",href:"https://clang.llvm.org/docs/HowToSetupToolingForLLVM.html"},"clang-tooling")," to\nobtain C/C++ AST of files under test. Note that clang-tooling requires a compilation database to work. Essentially, a\ncompilation database is a structural representation of compile commands used to obtain C/C++ object files from project\nsources, and it is also retrieved from the build system by UTBot. UTBot treats functions as structural units of the\nproject and generates tests for them. In order to achieve this, UTBot creates symbolic wrappers called KLEE files for\nevery project source file, ",(0,n.kt)("a",{parentName:"p",href:"preparing-sources-for-klee"},"more info"),", that use symbolic variables concept for symbolic\nexecution. Symbolic variables can be treated as logical constraints for variables, which are transformed into concrete\nvalues as the result of symbolic execution. Symbolic variables are the core of symbolic execution approach to software\nverification, and they are used in many successful tools for software verification and test generation."),(0,n.kt)("p",null,"Then, UTBot uses information about project compilation and linkage to rebuild the project in LLVM\nbitcode ",(0,n.kt)("a",{parentName:"p",href:"linking-bitcode"},"more info"),". This is done to pass the linkage result (.bc file) to KLEE. If a function calls\nother functions from the project, UTBot can provide KLEE with their bitcode as well, or, depending on user preferences,\nuse generated symbolic stubs for them ",(0,n.kt)("a",{parentName:"p",href:"stubs"},"stubs"),"."),(0,n.kt)("p",null,"KLEE produces files that represent test cases for a given function, and UTBot parses and transforms them to C++ test\nfiles (For supported C/C++ features, see ",(0,n.kt)("a",{parentName:"p",href:"c-syntax"},"c syntax"),", ",(0,n.kt)("a",{parentName:"p",href:"cpp-syntax"},"c++ syntax"),"), which present the test cases\nwith ",(0,n.kt)("a",{parentName:"p",href:"https://google.github.io/googletest/"},"GoogleTest")," framework. UTBot also provides its users with a build system for\ngenerated tests, automatically compiling and linking them with project files. Users can run\ntests ",(0,n.kt)("a",{parentName:"p",href:"generating-and-running-tests"},"more info")," with a single click and see the results and coverage information in\nVSCode Panel. UTBot uses Makefiles for test runs ",(0,n.kt)("a",{parentName:"p",href:"incrementality"},"more info"),", so UTBot tests can be used in continuous\nintegration."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"UTBotCpp pipeline",src:"https://github.com/UnitTestBot/unittestbot.github.io/raw/source/resources/images/pipelineUtbot.png"})),(0,n.kt)("p",null,"The most important things are described below in sequential order."),(0,n.kt)("h2",{id:"tests-generation"},"Tests Generation"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"install-vscode-plugin"},"Client")," sends request (one of ",(0,n.kt)("a",{parentName:"li",href:"generating-tests"},"types"),")\nto ",(0,n.kt)("a",{parentName:"li",href:"install-server"},"server"),".\nThe ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/testgens"},"corresponding")," object aggregates\nrequests' information."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/blob/main/server/src/fetchers/Fetcher.cpp"},"Fetcher")," fetches types, methods,\nglobal variable usages, array usages, includes for all files in request. It\nuses ",(0,n.kt)("a",{parentName:"li",href:"https://clang.llvm.org/docs/LibTooling.html"},"LibTooling")," for parsing source code, traversing types, etc."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/clang-utils/SourceToHeaderRewriter.cpp"},"SourceToHeaderRewriter"),"\ngenerates headers (.h files) based on source (.c files)."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/FeaturesFilter.cpp"},"FeaturesFilter")," filters out all\nmethods except the ones listed in ",(0,n.kt)("a",{parentName:"li",href:"c-syntax"},"supported syntax"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/Synchronizer.cpp"},"Synchronizer"),"\nsynchronizes ",(0,n.kt)("a",{parentName:"li",href:"stubs"},"stubs")," and wrappers for all files\nin ",(0,n.kt)("a",{parentName:"li",href:"https://clang.llvm.org/docs/JSONCompilationDatabase.html"},"compile_commands.json"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/KleeGenerator.cpp"},"KleeGenerator")," generates klee files\nas well as source files, also builds them in ",(0,n.kt)("a",{parentName:"li",href:"https://llvm.org/docs/BitCodeFormat.html"},"bitcode")," files."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/building/Linker.cpp"},"Linker")," links bitcode files\ntogether into module."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/building/Linker.cpp"},"Linker"),"\nwrites ",(0,n.kt)("a",{parentName:"li",href:"makefiles"},"Makefiles"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/KleeRunner.cpp"},"KleeRunner"),"\nruns ",(0,n.kt)("a",{parentName:"li",href:"https://klee.github.io/"},"KLEE")," on module consecutively for each method from request."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/KleeGenerator.cpp"},"KleeGenerator")," parses output of\nKLEE and writes files of ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/google/googletest"},"GoogleTest"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"install-server"},"Server")," sends final response to client and also transfers generated files for remote scenario.")),(0,n.kt)("h2",{id:"tests-running"},"Tests Running"),(0,n.kt)("p",null,"When user runs the tests, server performs various operations that might depend on the compiler used by the project."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"install-vscode-plugin"},"Client")," sends request to ",(0,n.kt)("a",{parentName:"li",href:"install-server"},"server"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/TestRunner.cpp"},"TestRunner")," chooses coverage\ntool based on the compiler used by the project. It\nis ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/GcovCoverageTool.cpp"},"GcovCoverageTool")," in\ncase of ",(0,n.kt)("a",{parentName:"li",href:"https://gcc.gnu.org/"},"gcc"),"\nand ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/LlvmCoverageTool.cpp"},"LlvmCoverageTool"),"\nin case of ",(0,n.kt)("a",{parentName:"li",href:"https://clang.llvm.org/"},"clang"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/TestRunner.cpp"},"TestRunner")," collects list of\ntuples (file path, suite name, test name) based on the information from the ",(0,n.kt)("a",{parentName:"li",href:"install-vscode-plugin"},"client"),"."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/TestRunner.cpp"},"TestRunner")," incrementally\nbuilds tests with instrumented options (coverage and sanitizer). To achieve this ",(0,n.kt)("a",{parentName:"li",href:"makefiles"},"Makefiles")," are used."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/TestRunner.cpp"},"TestRunner")," runs tests by\ncalling ",(0,n.kt)("a",{parentName:"li",href:"https://www.gnu.org/software/make/manual/make.html"},"make")," on makefiles that correspond to the given sources."),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/blob/main/server/src/coverage/CoverageAndResultsGenerator.cpp"},"CoverageAndResultsGenerator"),"\ncollects coverage information using previously chosen tool.",(0,n.kt)("ul",{parentName:"li"},(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/GcovCoverageTool.cpp"},"GcovCoverageTool"),"\nruns ",(0,n.kt)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Gcov.html"},"gcov"),"\non ",(0,n.kt)("a",{parentName:"li",href:"https://gcc.gnu.org/onlinedocs/gcc/Gcov-Data-Files.html"},".gcno and .gcda")," files. It provides a report\nin ",(0,n.kt)("inlineCode",{parentName:"li"},".json")," format."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/LlvmCoverageTool.cpp"},"LlvmCoverageTool"),"\nruns ",(0,n.kt)("a",{parentName:"li",href:"https://llvm.org/docs/CommandGuide/llvm-profdata.html"},"llvm-profdata")," to merge several .profraw files into\none. It provides a report in ",(0,n.kt)("inlineCode",{parentName:"li"},".json")," format using ",(0,n.kt)("a",{parentName:"li",href:"https://llvm.org/docs/CommandGuide/llvm-cov.html"},"llvm-cov"),"."))),(0,n.kt)("li",{parentName:"ol"},"Both ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/GcovCoverageTool.cpp"},"GcovCoverageTool"),"\nand ",(0,n.kt)("a",{parentName:"li",href:"https://github.com/UnitTestBot/UTBotCpp/tree/main/server/src/coverage/LlvmCoverageTool.cpp"},"LlvmCoverageTool"),"\nread generated ",(0,n.kt)("inlineCode",{parentName:"li"},".json")," file and determine set of covered lines."),(0,n.kt)("li",{parentName:"ol"},"Finally, ",(0,n.kt)("a",{parentName:"li",href:"install-server"},"Server")," sends response to the client.")))}m&&m===Object(m)&&Object.isExtensible(m)&&!Object.prototype.hasOwnProperty.call(m,"__filemeta")&&Object.defineProperty(m,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"src/docs/advanced/utbot-inside.md"}}),m.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-docs-advanced-utbot-inside-md-463b67dcfffe247f7a46.js.map